# 访客门禁系统

基于微信小程序云开发的访客门禁管理系统。

## 功能特性

- ✅ **用户注册登录** - 支持手机号注册、微信一键获取手机号
- ✅ **短信验证码** - 真实短信验证码发送和验证
- ✅ **个人中心** - 查看个人信息和开门记录
- ✅ **管理后台** - 数据大屏、用户管理
- ✅ **云数据库** - 基于微信云开发的数据存储
- ✅ **实时同步** - 前端与云端数据实时同步

## 技术栈

- **前端**: 微信小程序 + TDesign组件库
- **后端**: 微信云开发
- **数据库**: 云数据库
- **云函数**: Node.js

## 云开发配置

### 环境ID
```
cloud1-7giil3924402a7a3
```

### 云函数列表
1. **userRegister** - 用户注册
2. **userLogin** - 用户登录  
3. **sendSMS** - 短信发送

### 数据库集合
1. **users** - 用户表
2. **sms_codes** - 短信验证码表
3. **login_logs** - 登录日志表
4. **door_logs** - 开门记录表

详细配置请参考：[cloudbase/database.md](cloudbase/database.md)

## 部署步骤

### 1. 克隆项目
```bash
git clone <项目地址>
cd miniprogram-3
```

### 2. 配置云开发
1. 在微信开发者工具中打开项目
2. 开启云开发，使用环境ID: `cloud1-7giil3924402a7a3`
3. 创建数据库集合（参考 cloudbase/database.md）

### 3. 部署云函数
1. 右键 `cloudfunctions/userRegister` → 上传并部署
2. 右键 `cloudfunctions/userLogin` → 上传并部署
3. 右键 `cloudfunctions/sendSMS` → 上传并部署

### 4. 配置权限
- 数据库权限：仅创建者可读写
- 云函数权限：默认配置

### 5. 测试功能
1. 编译运行小程序
2. 测试用户注册流程
3. 验证短信发送功能
4. 检查数据库数据

## 目录结构

```
miniprogram-3/
├── miniprogram/           # 小程序前端代码
│   ├── pages/            # 页面文件
│   │   ├── register/     # 用户注册
│   │   ├── me/          # 个人中心
│   │   └── admin/       # 管理后台
│   ├── assets/          # 静态资源
│   └── app.js           # 应用入口
├── cloudfunctions/       # 云函数
│   ├── userRegister/    # 用户注册
│   ├── userLogin/       # 用户登录
│   └── sendSMS/         # 短信发送
├── cloudbase/           # 云开发配置
└── project.config.json  # 项目配置
```

## 开发说明

### 短信验证码
- 开发环境会在控制台显示验证码
- 生产环境需要集成真实短信服务（腾讯云短信等）
- 验证码有效期：5分钟
- 发送频率限制：1分钟内不能重复发送

### 数据安全
- 所有敏感操作通过云函数处理
- 数据库权限严格控制
- 用户数据仅创建者可访问

### 扩展功能
- 可集成人脸识别
- 支持二维码开门
- 添加访客审批流程
- 集成企业微信通知

## 常见问题

### 1. 云函数部署失败
- 检查网络连接
- 确认云开发环境已开启
- 验证package.json配置

### 2. 数据库权限错误
- 确认集合权限设置为"仅创建者可读写"
- 检查云函数中的数据库操作

### 3. 短信发送失败
- 检查手机号格式
- 确认云函数sendSMS部署成功
- 查看云函数日志

## 联系方式

如有问题请联系技术支持。 
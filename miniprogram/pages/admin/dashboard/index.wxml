<view class="dashboard-page">
  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="overview-card custom-card">
    <view class="card-title">ğŸ“ˆ æ¦‚è§ˆç»Ÿè®¡</view>
    <view class="card-content">
      <view class="stats-grid">
        <view class="stat-item">
          <view class="stat-value">{{overview.totalVisitors}}</view>
          <view class="stat-label">æ€»è®¿å®¢æ•°</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{overview.todayVisitors}}</view>
          <view class="stat-label">ä»Šæ—¥è®¿å®¢</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{overview.successRate}}%</view>
          <view class="stat-label">å¼€é—¨æˆåŠŸç‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{overview.avgLatency}}ms</view>
          <view class="stat-label">å¹³å‡å“åº”æ—¶é—´</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å›¾è¡¨åŒºåŸŸ -->
  <view class="charts-section">
    <!-- è¿‘7æ—¥æ¥è®¿äººæ•°æ›²çº¿å›¾ -->
    <view class="chart-card custom-card">
      <view class="card-title">ğŸ“ˆ è¿‘7æ—¥æ¥è®¿äººæ•°</view>
      <view class="chart-container">
        <view wx:if="{{weeklyData.length > 0}}" class="curve-chart">
          <!-- å›¾è¡¨ä¸»ä½“ -->
          <view class="chart-wrapper">
            <!-- èƒŒæ™¯ç½‘æ ¼çº¿ -->
            <view class="grid-background">
              <view wx:for="{{yAxisLabels}}" wx:key="index" class="grid-line" style="bottom: {{index * 20}}%;"></view>
            </view>
            
            <!-- Yè½´æ ‡ç­¾ -->
            <view class="y-axis-labels">
              <view wx:for="{{yAxisLabels}}" wx:key="index" class="y-label" style="bottom: {{index * 20}}%;">{{item}}</view>
            </view>
            
            <!-- æ›²çº¿å’Œæ•°æ®ç‚¹ -->
            <view class="chart-content">
              <!-- Canvas ç»˜åˆ¶è¿çº¿ -->
              <canvas 
                wx:if="{{weeklyData.length > 1}}"
                canvas-id="lineChart" 
                class="line-canvas"
                style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;">
              </canvas>
              
              <!-- æ•°æ®ç‚¹å’Œæ•°å€¼ -->
              <view wx:for="{{weeklyData}}" wx:key="index" class="data-point-wrapper" 
                    style="left: {{item.x}}%; bottom: {{item.y}}%;">
                <view class="data-point"></view>
                <view class="data-label">{{item.count}}</view>
              </view>
            </view>
            
            <!-- Xè½´æ ‡ç­¾ -->
            <view class="x-axis-labels">
              <view wx:for="{{weeklyData}}" wx:key="index" class="x-label" style="left: {{item.x}}%;">{{item.date}}</view>
            </view>
          </view>
        </view>
        <view wx:else class="no-data">æš‚æ— æ•°æ®</view>
      </view>
    </view>

    <!-- è®¿å®¢æ•°ç»Ÿè®¡ -->
    <view class="chart-card custom-card">
      <view class="card-title">ğŸ“Š è®¿å®¢æ•°ç»Ÿè®¡</view>
      <view class="chart-container">
        <view class="chart-content">
          <view class="stat-row">
            <text class="stat-key">æ—¥å‡è®¿å®¢:</text>
            <text class="stat-value">{{monthlyStats.dailyAvg}}äºº</text>
          </view>
          <view class="stat-row">
            <text class="stat-key">æœˆæ€»è®¡:</text>
            <text class="stat-value">{{monthlyStats.monthlyTotal}}äºº</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ€§åˆ«åˆ†å¸ƒ -->
    <view class="chart-card custom-card">
      <view class="card-title">ğŸ‘¥ æ€§åˆ«åˆ†å¸ƒ</view>
      <view class="chart-container">
        <view class="chart-content">
          <view class="gender-stats">
            <view class="gender-item">
              <view class="gender-icon">ğŸ‘¨</view>
              <view class="gender-info">
                <text class="gender-label">ç”·æ€§</text>
                <text class="gender-percent">{{genderStats.male}}%</text>
              </view>
              <view class="gender-bar">
                <view class="gender-fill male" style="width: {{genderStats.male}}%"></view>
              </view>
            </view>
            <view class="gender-item">
              <view class="gender-icon">ğŸ‘©</view>
              <view class="gender-info">
                <text class="gender-label">å¥³æ€§</text>
                <text class="gender-percent">{{genderStats.female}}%</text>
              </view>
              <view class="gender-bar">
                <view class="gender-fill female" style="width: {{genderStats.female}}%"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¹´é¾„åˆ†å¸ƒ -->
    <view class="chart-card custom-card">
      <view class="card-title">ğŸ‚ å¹´é¾„åˆ†å¸ƒ</view>
      <view class="chart-container">
        <view class="chart-content">
          <view wx:if="{{ageDistribution.length > 0}}" class="age-stats">
            <view wx:for="{{ageDistribution}}" wx:key="index" class="age-item">
              <text class="age-range">{{item.range}}</text>
              <view class="age-bar">
                <view class="age-fill" style="width: {{item.count > 0 ? (item.count / maxAgeCount * 100) : 0}}%"></view>
              </view>
              <text class="age-count">{{item.count}}äºº</text>
            </view>
          </view>
          <view wx:else class="no-data">æš‚æ— æ•°æ®</view>
        </view>
      </view>
    </view>

    <!-- 24hæ—¶æ®µæ´»è·ƒ -->
    <view class="chart-card custom-card">
      <view class="card-title">ğŸ• 24å°æ—¶æ´»è·ƒåˆ†å¸ƒ</view>
      <view class="chart-container">
        <view class="chart-content">
          <view wx:if="{{peakHours.length > 0}}" class="peak-hours">
            <text class="peak-title">é«˜å³°æ—¶æ®µ:</text>
            <view class="peak-list">
              <text wx:for="{{peakHours}}" wx:key="index" class="peak-hour">{{item}}</text>
            </view>
          </view>
          <view wx:else class="no-data">æš‚æ— æ•°æ®</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯¼å‡ºæŒ‰é’® -->
  <view class="export-section">
    <button class="export-btn {{exporting ? 'disabled' : 'active'}}" bindtap="onExportCSV" disabled="{{exporting}}">
      {{exporting ? 'å¯¼å‡ºä¸­...' : 'ğŸ“ å¯¼å‡ºCSVæ•°æ®'}}
    </button>
  </view>
</view> 